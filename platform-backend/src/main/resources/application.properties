# Platform Backend Application Properties
# Environment-specific overrides can be provided via .env file

# Application
spring.application.name=platform-backend
server.port=${SERVER_PORT:8081}

# Database Configuration
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/banditgames}
spring.sql.init.mode=always
# SQL script for initializing all platform data (idempotent)
spring.sql.init.data-locations=classpath:sql/init_data.sql,classpath:sql/migration_fix_lobby_status_constraint.sql
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.defer-datasource-initialization=true

# RabbitMQ Configuration
spring.rabbitmq.host=${RABBITMQ_HOST:banditgames-rabbit}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USER:admin}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:admin}
spring.rabbitmq.virtual-host=${RABBITMQ_VHOST:/}
spring.rabbitmq.connection-timeout=60000
spring.rabbitmq.publisher-confirm-type=correlated
spring.rabbitmq.publisher-returns=true
spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.listener.simple.retry.enabled=true
spring.rabbitmq.listener.simple.retry.max-attempts=3
spring.rabbitmq.listener.simple.retry.initial-interval=1000
spring.rabbitmq.listener.simple.default-requeue-rejected=false
spring.rabbitmq.listener.simple.prefetch=10

# Security - Keycloak OAuth2
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8180/realms/banditgames}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_JWK_SET_URI:http://localhost:8180/realms/banditgames/protocol/openid-connect/certs}

# Game Service Client Configuration
game.service.url=${GAME_SERVICE_URL:http://localhost:8000}
game.service.api-key=${GAME_SERVICE_API_KEY:}
game.service.timeout-seconds=5

# Game Events Configuration
game.events.exchange.name=game_events
game.events.exchange.type=topic
game.events.exchange.durable=true
game.events.queues.move-requests=game.move.requests
game.events.queues.move-responses=game.move.responses
game.events.queues.move-applied=game.move.applied
game.events.queues.state-updates=game.state.updates
game.events.queues.achievements=game.achievements
game.events.queues.session-started=game.session.started
game.events.queues.session-ended=game.session.ended
game.events.routing-keys.move-request=game.move.request
game.events.routing-keys.move-response=game.move.response
game.events.routing-keys.move-applied=game.move.applied
game.events.routing-keys.state-updated=game.state.updated
game.events.routing-keys.achievement-unlocked=game.achievement.unlocked
game.events.routing-keys.session-started=game.session.started
game.events.routing-keys.session-ended=game.session.ended

# Chess Game Events Configuration (External Chess Service)
chess.game.exchange.name=gameExchange
chess.game.queues.game-created=chess.game.created
chess.game.queues.game-updated=chess.game.updated
chess.game.queues.game-ended=chess.game.ended
chess.game.queues.move-made=chess.move.made
chess.game.queues.game-registered=chess.game.registered
chess.game.queues.achievement-acquired=chess.achievement.acquired

# Resilience4j Circuit Breaker
resilience4j.circuitbreaker.instances.gameService.register-health-indicator=true
resilience4j.circuitbreaker.instances.gameService.sliding-window-size=10
resilience4j.circuitbreaker.instances.gameService.minimum-number-of-calls=5
resilience4j.circuitbreaker.instances.gameService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.gameService.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.instances.gameService.wait-duration-in-open-state=60s
resilience4j.circuitbreaker.instances.gameService.failure-rate-threshold=50

# Resilience4j Retry
resilience4j.retry.instances.gameService.max-attempts=3
resilience4j.retry.instances.gameService.wait-duration=1s

# Logging
logging.level.org.springframework.modulith=${LOG_LEVEL_MODULITH:INFO}
logging.level.org.springframework.security=${LOG_LEVEL_SECURITY:WARN}
logging.level.com.banditgames=${LOG_LEVEL_APP:INFO}

# Management/Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized

# Swagger/OpenAPI
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
